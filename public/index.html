<!-- public/index.html -->
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Entry .ent ë‹¤ìš´ë¡œë“œê¸°</title>
  <script src="https://rawcdn.githack.com/ankitrohatgi/tarballjs/refs/heads/master/tarball.js"></script>
</head>
<body>
  <h2>ì—”íŠ¸ë¦¬ ì‘í’ˆ .ent ë‹¤ìš´ë¡œë“œ</h2>
  <input id="projectId" placeholder="ì‘í’ˆ ID ì…ë ¥" />
  <button onclick="downloadEnt()">ë‹¤ìš´ë¡œë“œ</button>
  <br><br>
  <progress value="0" max="1"></progress>
  <span></span>

  <script>
    async function downloadEnt() {
      const id = document.getElementById("projectId").value.trim();
      const span = document.querySelector("span");
      const progress = document.querySelector("progress");
  
      if (!id) {
        alert("ì‘í’ˆ IDë¥¼ ì…ë ¥í•˜ì„¸ìš”!");
        return;
      }
  
      span.innerText = "ì‘í’ˆ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...";
      progress.value = 0.2;
  
      const res = await fetch(`/api/entry?id=${id}`);
      const requestData = await res.json();
  
      if (!requestData?.data?.project) {
        span.innerText = "âŒ í”„ë¡œì íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
        return;
      }
  
      progress.value = 0.6;
      span.innerText = "íŒŒì¼ ìƒì„± ì¤‘...";
  
      const file = new File(
        [new Blob([JSON.stringify(requestData.data)])],
        "temp/project.json"
      );
  
      const tar = new tarball.TarWriter();
      tar.addFile("temp/project.json", file);
  
      const projectName = requestData.data.project.name || "project";
      const safeName = projectName.replace(/[\\/:*?"<>|]+/g, "_");
  
      progress.value = 0.9;
      span.innerText = `ğŸ“¦ ${safeName}.ent ë‹¤ìš´ë¡œë“œ ì¤‘...`;
  
      tar.download(`${safeName}.ent`);
  
      progress.value = 1;
      span.innerText = "ë‹¤ìš´ë¡œë“œ ì™„ë£Œ!";
    }
  </script>  
</body>
</html>
